<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Sayfayı 20 dakikada bir yenile -->
    <meta http-equiv="refresh" content="1200">
    <title>Duyuru Sayfası</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }
        .carousel {
            width: 100%;
        }
        .carousel-inner {
            width: 100%;
        }
        .carousel-item {
            width: 100%;
        }
        .carousel-item img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators" id="carousel-indicators">
          <!-- Göstergeler dinamik olarak eklenecek -->
        </ol>
        <div class="carousel-inner" id="carousel-inner">
          <!-- Slider öğeleri dinamik olarak eklenecek -->
        </div>
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Önceki</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Sonraki</span>
        </a>
      </div>

</body>
<script>
    $(document).ready(function(){
        // API URL'sini dinamik olarak belirle
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000/api'
            : 'https://slider-backend.onrender.com/api';
        
        // Resimleri API'den çek
        function resimleriGetir() {
            $.ajax({
                url: `${API_URL}/images`,
                method: 'GET',
                success: function(data) {
                    resimleriGoster(data);
                },
                error: function(err) {
                    console.error('Resimler yüklenirken hata oluştu:', err);
                    // Hata durumunda LocalStorage'dan yükle
                    const resimler = JSON.parse(localStorage.getItem('sliderResimleri')) || [
                        { url: "kedi.jpg" },
                        { url: "4.jpg" },
                        { url: "6.jpg" },
                        { url: "resim1.jpg" },
                        { url: "resim2.jpg" },
                        { url: "resim3.jpg" }
                    ];
                    resimleriGoster(resimler);
                }
            });
        }
        
        // Resimleri carousel'a ekle
        function resimleriGoster(resimler) {
            // Resimleri sıraya göre sırala
            resimler.sort((a, b) => (a.order || 0) - (b.order || 0));
            
            // Carousel göstergelerini oluştur
            let indicatorsHtml = '';
            resimler.forEach((resim, index) => {
                indicatorsHtml += `<li data-target="#carouselExampleIndicators" data-slide-to="${index}" ${index === 0 ? 'class="active"' : ''}></li>`;
            });
            $('#carousel-indicators').html(indicatorsHtml);
            
            // Carousel öğelerini oluştur
            let itemsHtml = '';
            resimler.forEach((resim, index) => {
                itemsHtml += `
                    <div class="carousel-item ${index === 0 ? 'active' : ''}">
                        <img src="${resim.url}" class="d-block w-100" alt="Slider Resim ${index + 1}">
                    </div>
                `;
            });
            $('#carousel-inner').html(itemsHtml);
            
            // Carousel'ı başlat
            $('#carouselExampleIndicators').carousel({
                interval: 5000 // 5 saniye
            });
        }
        
        // Sayfa yüklendiğinde resimleri getir
        resimleriGetir();
        
        // Her 5 dakikada bir resimleri güncelle
        setInterval(resimleriGetir, 300000); // 300000 ms = 5 dakika
        
        // 20 dakikada bir sayfayı yenile (JavaScript ile)
        setTimeout(function() {
            window.location.reload();
        }, 1200000); // 1200000 ms = 20 dakika
    });
</script>
</html>